## 最朴素的功能需求
1. 需要支持用户聊天
2. 需要支持用户一块设计文档
3. 需要支持用户设计表格
4. 需要支持用户对自已设计的表格录入数据、编辑数据、删除数据、各种查看及统计
5. 需要支持用户上传文件资源
6. 需要记录用户上传文件或调用接口调了多少次，上传文件消耗了多少流量、占用了多大的空间
7. 需要支持用户扫一个二维码，可以付款（付款支付宝、微信）
8. 需要用户扫一个二维码就可以登录或注册，也可以用手机短信来注册登录（不用密码）
## 功能设计简要
1. 通信基本以websocket为主，对于较大的文件，仍然走web接口，返回网址，这里会先对文件生成md5，然后查一下md5,存在直接返回网址
2. 通信方式可以在websocket与http之间可以切换（当然后台推送前台没的换）
3. 方便后述大量用户使用的扩展性需要，支持分布式部署，即一台电脑部署n个后台服务，可以多台电脑，
每一个后台服务为一个进程（占用相应的端口），保留一个主后台服务（主要就是用来分配的）
4. 对于每一个用户，需要通过主后台服务查找可用的进程服务（找到后，存下来，以后这个用户将被固定下来分配到这个进程）
5. 第三方身份上的安全性校验。主要是用户设计的表格，是可以对外提供第三方应用来查询数据、删除数据等等，现假设第三方想用某个接口服务，那非常简单，添加一个虚拟的机器人，该虚拟机器人需要用户上传公钥，私钥自已保留，接口用公钥验签。
6. 对于同一个客户端，一些接口访问在1s内最大访问次数不能超过一个值（3次），如果超过，该接口将对当前的客户端禁用。
7. 对于一些请求，需要缓存一会，再插入到数据库（比如一些操作日志，在短时间内有大量数据，可先缓存，再批量插入）
8. 一个用户是可以登录多个客户端，也支持用户登录两个不同的浏览，区分是用户userid+[浏览器标识](https://github.com/fingerprintjs/fingerprintjs)
## 功能设计的关键
### 用户如何多人协同
![通信流程图](/img/sock.jpg)
客户端:提供各种跨平台的客户端  
第三方应用：用户可以设计表格，所以第三方可以对当前的这个表格做一些操作（curd)  
服务进程：
* 主进程：主要是通过userid查找当前用户被分配到那个服务子程序（没查到就主动分配一个），通常提供2~3三个（随机调用，不能调用就换一个）
* 服务子进程：主要是给用户提供服务的进程，一旦分配，则不可更改（就像分配的小姐姐，除非小姐姐不在线，否则每次分配的都是她）
> 主进程只提供http接口，主要是用来查询用户被分配那个进程，服务子进程之间会形成一个网状的通信结构，至于形状取决于用户之间的通信关系。
通信的场景
例如有a,b，c三个用户在同时编辑一个文档，但该文档的所有权归d，现假设c在编辑需要同步状态，
那么通信的流程为，c会找d所在的服务进程，而d所在的服务进程会查找当前文档有那些人参于过，然后通过主进程服务查找这些参于人的在线状态及这些人所在的服务子进程，查后就将信息发给这些服务子进程，让服务子进程将信息发到相应的客户端
### 用户如何设计表格、管理表格的增删改查

### 多人在编辑文档时，如何生成一份快照

## 答疑
1. 主后台服务 用户访问量过大怎么办
   用户一旦被分配后，将在相应的客户端缓存下来，客户端会决定找那台机器下面的某个进程服务，实际上刚注册的新用户，会产生一次分配的请求
2. 用户分配的进程服务挂了怎么办
   用户每次会联服务，如果发现联不上，会重新到主后台服务去申请一个新的可用的进程



